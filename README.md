# ball_detection
Детекция красного мячика
Пример проекта, который будет приниматься на финальной защите. Должен состоять из 10 слайдов:

 ```
 1. Название проекта. 
 2. Описание проблемы которую вы хотите решить. 
 3. Актуальность. 
 4. Цели, Задачи. 
 5. Описание продукта (прототип). 
 6. Конкуренты, аналоги, таблица сравнения. 
 7. Новизна. 
 8. Перспективы развития. 
 9. Спасибо за внимание, ваш телефон, почта и др. реквизиты.
10. Ссылка на гитхаб и на видео
```

Каждый пункт оценивается 1 баллом. Суммарно 10 баллов.
Дополнительная информация в папке information

В проекте детектиться красный мячик hsv фильтром, обводится зеленым bounting box.
HSV - hue (цветовой тон), saturation (насыщенность), value (якрость)

Презентация проекта: https://docs.google.com/presentation/d/1ruG29Lmi03Z-nsCHz7t_0BgRYdm9szNrwO9jh8VZGm0/edit?usp=sharing

Пример прошлогодней работы: https://t.me/c/2255724543/2262 

Тема проекта:
Детекция какого либо предмета по цвету
Например:
Мяч, солнце, облака, яблоки, апельсины, люди, поле, линия горизонта, пол, снег, небо и т.д.

Заявить проект до 26 марта 2026 года

# HSV Filter — калибровка и фильтрация по цвету (HSV)

Приложение для настройки HSV-фильтра по изображению или видео: подбор порогов по цвету (Hue, Saturation, Value) и по площади объектов, сохранение настроек и экспорт результата.

---

## Возможности

- **Режим изображения** — загрузка одного изображения (jpg и др.), калибровка фильтра в реальном времени.
- **Режим видео** — обработка видеофайла по кадрам с записью результата в `output.avi`.
- **HSV-калибровка** — шесть ползунков: нижняя и верхняя границы по Hue (тон), Saturation (насыщенность), Value (яркость).
- **Фильтр по площади** — отсечение объектов по минимальной и максимальной площади (в пикселях).
- **Сохранение настроек** — запись текущих значений в `hsv_filter.json` по нажатию клавиши.
- **Два окна** — исходное изображение с обведёнными объектами и бинарная маска по выбранному цвету.

---

## Требования

- Python 3.x (для запуска из исходников)
- Зависимости: `opencv-python`, `numpy` (см. `requirements.txt`)

---

## Запуск

### Вариант 1: из исходников (Python)

1. Установить зависимости:
   ```bash
   pip install -r requirements.txt
   ```
2. Положить рядом со скриптом:
   - `conf.json` — настройки входа (файл, тип: img/video и т.д.)
   - `hsv_filter.json` — начальные значения HSV и площади (создаётся при первом сохранении по **S**)
   - Файл изображения или видео, указанный в `conf.json` в `file_name`
3. Запустить:
   ```bash
   python test_opencv_hsv.py
   ```

### Вариант 2: готовый EXE из releases GitHub 

1. Собрать EXE (один раз):
   ```bash
   build_exe.bat
   ```
   Или вручную:
   ```bash
   pip install -r requirements.txt
   pip install pyinstaller
   pyinstaller --onefile --name "HSV_Filter" --clean test_opencv_hsv.py
   ```
2. EXE появится в папке `dist\HSV_Filter.exe`.
3. Рядом с `HSV_Filter.exe` обязательно положить:
   - **conf.json** — конфиг (какой файл открывать, img/video, коэффициент масштаба и т.д.)
   - **hsv_filter.json** — начальные/сохранённые значения HSV и площади (если нет — используются значения по умолчанию из кода).
   - Файл изображения или видео с именем, указанным в `conf.json` в поле `file_name` (например `img.jpg` или `apples.mp4`).

Приложение ищет `conf.json` и `hsv_filter.json` в той же папке, где лежит EXE (или скрипт).

---

## Конфигурация: conf.json

Пример:

```json
{
  "resize_coef": 0.5,
  "file_name": "img.jpg",
  "file_type": "img",
  "time_sleep": 100,
  "output_file_name": "output"
}
```

| Параметр           | Описание |
|--------------------|----------|
| `resize_coef`      | Коэффициент масштаба (0.0–1.0). Уменьшает размер кадра для ускорения (например, 0.5 — половина по ширине и высоте). |
| `file_name`        | Имя файла изображения или видео (например `img.jpg`, `apples.mp4`). Файл должен лежать в той же папке, что и EXE/скрипт, либо указан полный путь. |
| `file_type`        | Режим: `"img"` — одно изображение, `"video"` — видеофайл с записью результата в `output.avi`. |
| `time_sleep`       | Задержка между кадрами в миллисекундах (влияет на скорость перебора и отзывчивость при нажатии клавиш). Для изображения — задержка при опросе клавиш. |
| `output_file_name` | Имя для выходного файла (в коде сейчас используется фиксированное имя `output.avi` для видео; параметр можно использовать при доработке). |

---

## Калибровка HSV: hsv_filter.json

Пример:

```json
{
  "low": [0, 0, 54],
  "high": [255, 255, 255],
  "area": [517, 100000]
}
```

| Параметр | Описание |
|----------|----------|
| `low`    | Нижние границы HSV: `[H_min, S_min, V_min]`, каждое значение 0–255. |
| `high`   | Верхние границы HSV: `[H_max, S_max, V_max]`, каждое значение 0–255. |
| `area`   | `[area_min, area_max]` — минимальная и максимальная площадь объекта в пикселях. Объекты вне этого диапазона не рисуются. |

При первом запуске файл `hsv_filter.json` должен содержать все три ключа: `low`, `high`, `area`. Если файла нет — скопируйте пример выше или сохраните настройки клавишей **S** после того, как программа уже запустилась (при первом запуске без файла возможна ошибка из-за отсутствия `area`). После нажатия **S** создаётся/обновляется `hsv_filter.json` с полями `low`, `high`, `area`.

---

## Окно «HSV_Trackbar» — ползунки (калибровка)

| Ползунок          | Параметр   | Диапазон  | Назначение |
|-------------------|------------|-----------|------------|
| hue_low           | H минимум  | 0–255     | Нижняя граница по тону (цвету). |
| hue_high          | H максимум | 0–255     | Верхняя граница по тону. |
| saturation_low    | S минимум  | 0–255     | Нижняя граница по насыщенности. |
| saturation_high   | S максимум | 0–255     | Верхняя граница по насыщенности. |
| value_low         | V минимум  | 0–255     | Нижняя граница по яркости. |
| value_high        | V максимум | 0–255     | Верхняя граница по яркости. |
| area_min          | Площадь мин| 0–1000    | Минимальная площадь объекта (пиксели). |
| area_max          | Площадь макс | 0–100000 | Максимальная площадь объекта (пиксели). |

Движение ползунков сразу меняет маску и обводку объектов на изображении.

---

## Клавиши управления

| Клавиша   | Действие |
|-----------|----------|
| **S**     | Сохранить текущие значения ползунков в `hsv_filter.json` (low, high, area). |
| **Esc**   | Выход из приложения. |
| **Пробел**| Выход из приложения. |

Других кнопок в коде нет; все настройки — через ползунки и конфиги.

---

## Окна приложения

- **HSV_Trackbar** — панель с ползунками для настройки HSV и площади.
- **camera** — исходное изображение/кадр с зелёными прямоугольниками вокруг объектов, попавших в фильтр по HSV и по площади, и подписью с площадью и усреднённым размером.
- **Mask** — бинарная маска: белое — попало в диапазон HSV, чёрное — нет (фильтр по площади применяется только к обводке, не к маске).

---

## Режим видео и выходной файл

- При `"file_type": "video"` приложение читает кадры из `file_name`, обрабатывает их с текущими HSV и area и пишет результат в файл **output.avi** в текущей рабочей папке (папка EXE при запуске EXE).
- FPS выходного видео задаётся в коде как `fps = cap.get(cv2.CAP_PROP_FPS) // 3` (треть от исходного).
- Формат: AVI, кодек MJPG.

---

## Сборка EXE (кратко)

- **build_exe.bat** — устанавливает зависимости и PyInstaller, собирает один файл `dist\HSV_Filter.exe`.
- Рядом с EXE нужны: `conf.json`, `hsv_filter.json` и сам файл (картинка/видео) из `file_name`.

---

## Важные замечания

1. **Пути к файлам** — при запуске EXE рабочая папка — каталог с EXE; `conf.json`, `hsv_filter.json` и `file_name` ищутся там (или по абсолютному пути в `file_name`).
2. **Первый запуск без hsv_filter.json** — в коде заданы значения по умолчанию; если в загружаемом JSON нет ключа `area`, возможна ошибка при создании ползунков. Лучше сразу создать `hsv_filter.json` с полем `"area": [0, 100000]` или сохранить настройки клавишей **S** после первого запуска.
3. **test_open_file.py** — вспомогательный скрипт для работы с `hsv_filter.json` (чтение/запись), не входит в EXE. Основная программа — **test_opencv_hsv.py**.

---

## Краткая шпаргалка

| Что сделать           | Действие |
|----------------------|----------|
| Запустить из кода    | `python test_opencv_hsv.py` (нужны `conf.json`, `hsv_filter.json`, файл из `file_name`). |
| Собрать EXE          | Запустить `build_exe.bat` → EXE в `dist\HSV_Filter.exe`. |
| Запустить EXE        | Положить рядом `conf.json`, `hsv_filter.json` и файл из `file_name`, затем запустить `HSV_Filter.exe`. |
| Подобрать цвет       | Двигать ползунки в окне «HSV_Trackbar», смотреть «camera» и «Mask». |
| Сохранить калибровку | Нажать **S** → обновляется `hsv_filter.json`. |
| Выйти                | **Esc** или **Пробел**. |
